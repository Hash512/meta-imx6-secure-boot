From 9cb733fc5cd238e9a90763b6cbe8becc382a3282 Mon Sep 17 00:00:00 2001
From: Sven Ebenfeld <sven.ebenfeld@gmail.com>
Date: Sat, 24 Dec 2016 04:08:59 +0100
Subject: [PATCH] lib:Config.py: allow any ssl connection

Signed-off-by: Sven Ebenfeld <sven.ebenfeld@gmail.com>
---
 lib/Config.py   | 3 ++-
 sbin/db_mgmt.py | 6 ++++++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/lib/Config.py b/lib/Config.py
index d96b33c..cc56e64 100644
--- a/lib/Config.py
+++ b/lib/Config.py
@@ -24,6 +24,7 @@ import re
 import urllib.parse
 import urllib.request as req
 import zipfile
+import ssl
 from io import BytesIO
 
 class Configuration():
@@ -268,7 +269,7 @@ class Configuration():
             auth = req.HTTPBasicAuthHandler()
             opener = req.build_opener(proxy, auth, req.HTTPHandler)
             req.install_opener(opener)
-        response = req.urlopen(getfile)
+        response = req.urlopen(getfile, context=ssl._create_unverified_context())
         data = response
         # TODO: if data == text/plain; charset=utf-8, read and decode
         if unpack:
diff --git a/sbin/db_mgmt.py b/sbin/db_mgmt.py
index aaa6e7b..d2ea7d2 100755
--- a/sbin/db_mgmt.py
+++ b/sbin/db_mgmt.py
@@ -197,6 +197,8 @@ if __name__ == '__main__':
         try:
             (f, r) = Configuration.getFile(Configuration.getFeedURL('cve') + getfile)
         except:
+            tb = traceback.format_exc()
+            print (tb)
             sys.exit("Cannot open url %s. Bad URL or not connected to the internet?"%(Configuration.getFeedURL("cve") + getfile))
         i = db.getInfo("cve")
         last_modified = parse_datetime(r.headers['last-modified'], ignoretz=True)
@@ -228,6 +230,8 @@ if __name__ == '__main__':
         try:
             (f, r) = Configuration.getFile(Configuration.getFeedURL('cve') + getfile)
         except:
+            tb = traceback.format_exc()
+            print (tb)
             sys.exit("Cannot open url %s. Bad URL or not connected to the internet?"%(Configuration.getFeedURL("cve") + getfile))
         parser = make_parser()
         ch = CVEHandler()
@@ -268,6 +272,8 @@ if __name__ == '__main__':
                 try:
                     (f, r) = Configuration.getFile(Configuration.getFeedURL('cve') + getfile)
                 except:
+                    tb = traceback.format_exc()
+                    print (tb)
                     sys.exit("Cannot open url %s. Bad URL or not connected to the internet?"%(Configuration.getFeedURL('cve') + getfile))
                 parser.parse(f)
                 if args.v:
-- 
2.7.4

